/*!
 * jQCloud Plugin for jQuery
 *
 * Version 1.0.2
 *
 * Copyright 2011, Luca Ongaro
 * Licensed under the MIT license.
 *
 * Date: Tue Oct 09 22:08:53 +0200 2012
 */
(function(e){"use strict",e.fn.jQCloud=function(t,n){var r=this,i=r.attr("id")||Math.floor(Math.random()*1e6).toString(36),s={width:r.width(),height:r.height(),center:{x:(n&&n.width?n.width:r.width())/2,y:(n&&n.height?n.height:r.height())/2},delayedMode:t.length>50,shape:!1,encodeURI:!0};n=e.extend(s,n||{}),r.addClass("jqcloud").width(n.width).height(n.height),r.css("position")==="static"&&r.css("position","relative");var o=function(){var s=function(e,t){var n=function(e,t){return Math.abs(2*e.offsetLeft+e.offsetWidth-2*t.offsetLeft-t.offsetWidth)<e.offsetWidth+t.offsetWidth&&Math.abs(2*e.offsetTop+e.offsetHeight-2*t.offsetTop-t.offsetHeight)<e.offsetHeight+t.offsetHeight?!0:!1},r=0;for(r=0;r<t.length;r++)if(n(e,t[r]))return!0;return!1};for(var o=0;o<t.length;o++)t[o].weight=parseFloat(t[o].weight,10);t.sort(function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0});var u=n.shape==="rectangular"?18:2,f=[],l=n.width/n.height,h=function(o,h){var p=i+"_word_"+o,v="#"+p,m=6.28*Math.random(),g=0,y=0,w=0,E=5,S="",x="",T="";h.html=e.extend(h.html,{id:p}),h.html&&h.html["class"]&&(S=h.html["class"],delete h.html["class"]),t[0].weight>t[t.length-1].weight&&(E=Math.round((h.weight-t[t.length-1].weight)/(t[0].weight-t[t.length-1].weight)*9)+1),T=e("<span>").attr(h.html).addClass("w"+E+" "+S),h.link?(typeof h.link=="string"&&(h.link={href:h.link}),n.encodeURI&&(h.link=e.extend(h.link,{href:encodeURI(h.link.href).replace(/'/g,"%27")})),x=e("<a>").attr(h.link).text(h.text)):x=h.text,T.append(x);if(!!h.handlers)for(var N in h.handlers)h.handlers.hasOwnProperty(N)&&typeof h.handlers[N]=="function"&&e(T).bind(N,h.handlers[N]);r.append(T);var C=T.width(),k=T.height(),L=n.center.x-C/2,A=n.center.y-k/2,O=T[0].style;O.position="absolute",O.left=L+"px",O.top=A+"px";while(s(document.getElementById(p),f)){if(n.shape==="rectangular"){y++,y*u>(1+Math.floor(w/2))*u*(w%4%2===0?1:l)&&(y=0,w++);switch(w%4){case 1:L+=u*l+Math.random()*2;break;case 2:A-=u+Math.random()*2;break;case 3:L-=u*l+Math.random()*2;break;case 0:A+=u+Math.random()*2}}else g+=u,m+=(o%2===0?1:-1)*u,L=n.center.x-C/2+g*Math.cos(m)*l,A=n.center.y+g*Math.sin(m)-k/2;O.left=L+"px",O.top=A+"px"}f.push(document.getElementById(p)),e.isFunction(h.afterWordRender)&&h.afterWordRender.call(T)},p=function(i){i=i||0;if(!r.is(":visible")){setTimeout(function(){p(i)},10);return}i<t.length?(h(i,t[i]),setTimeout(function(){p(i+1)},10)):e.isFunction(n.afterCloudRender)&&n.afterCloudRender.call(r)};n.delayedMode?p():(e.each(t,h),e.isFunction(n.afterCloudRender)&&n.afterCloudRender.call(r))};return setTimeout(function(){o()},10),r}})(jQuery);