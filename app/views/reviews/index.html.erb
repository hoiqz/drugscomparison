<% content_for :script do %>
    <script type='text/javascript' xmlns="http://www.w3.org/1999/html">
        /*!
         * Create an array of word objects, each representing a word in the cloud
         */
        var word_array = [
                <% @tagshash.each_pair do |key,value|%>
                    {text: "<%=key%>", weight: <%= value.to_i%>, link: "<%= DOMAIN_NAME%>/searches/<%= @drug.id%>/non_form_search?keyword=<%=u key%>&<%= @urlendcoded %>"},
                <% end%>

            //{text: "Ipsum", weight: 9, link: "http://jquery.com/"},
            //{text: "Dolor", weight: 6, html: {title: "I can haz any html attribute"}},

        ];

        $(function () {
            $('.paginator nav span a').live('click', function () {
                $.getScript(this.href);
                return false;
            });
            $('#write_review').bind('click',function(){
                if ($("#new_review").hasClass("hide"))
                {
                $("#new_review").removeClass("hide");
                }
                else
                {
                    $("#new_review").addClass("hide");
                }
            });
            $("#effectlink").popover();
            $("#eoulink").popover();
            $("#satisfylink").popover();
            $("#tag_cloud_link").popover();
            //$("#tagcloud").jQCloud(word_array);
        });
    </script>
<% end %>



<p>
  <b>Generic name:</b>
  <%= @drug.generic_name %>
</p>

<p>
  <b>Brand name:</b>
  <%= @drug.brand_name %>
</p>

<p>
  <b>Side effect:</b>
  <%= @drug.side_effect %>
</p>

<p>
  <b>Dosage:</b>
  <%= @drug.dosage %>
</p>

<p>
  <b>Precaution:</b>
  <%= @drug.precaution %>
</p>

<p>
  <b>Manufacturer:</b>
  <%= @drug.manufacturer %>
</p>


<div id="chart_container" class="row-fluid">
  <div id="reviews_chart" class="span12">
    <!-- You should explicitly specify the dimensions of the container element -->
    <div id="myCarousel" class="carousel slide" data-interval="15000">
      <!-- Carousel items -->
      <div class="carousel-inner">
        <div class="active item">
          <div id="avg_sat_infograph">
            <h3>Overall<br><span class="focus3">Satisfaction</span></h3>
            <span id="maleleft"><span class="focus3"><%= @infograph.avg_sat_male.round(2)%></span> / 5</span>
            <span id="femaleright"><span class="focus3"><%= @infograph.avg_sat_female.round(2)%></span> / 5</span>
          </div>
        </div>
        <div class="item">
          <div id="freq_words_infograph">
              <ul>
              <li><span class="focus3">&ldquo;<%= @topwords.shift %></span></li>
              <li><span class="focus4"><%= @topwords.shift %></span></li>
              <li><span class="focus5"><%= @topwords.shift %>&rdquo;</span></li>
                </ul>

          </div>
        </div>
        <div class="item">
          <div id="age_breakdown_infograph">

            <ul>
              <li id="child"><%= @infograph.age_less_18.round(1) %></span></li>
              <li id="adult"><%= @infograph.age_btw_18_50.round(1) %></span></li>
              <li id="senior"><%= @infograph.age_more_50.round(1) %></span></li>
            </ul>
            <h3><span class="focus2"><%= @infograph.age_btw_18_50.round(1) %></span> % of our reviewers come from age group <br><span class="focus5">18 - 55</span></h3>
          </div>
        </div>
        <div class="item">
          <div id="gender_breakdown_infograph">

            <ul>
              <li><div class="human_bar1">
                <div style="width:<%= (@infograph.effective_over_3.round)*30 %>px"></div>
                <span class="focus2"><%= @infograph.effective_over_3.round %></span> in  <span class="focus3">10</span> <br>reviewers found this<br> drug effective.
              </div>
              </li>
              <li><div class="human_bar2">
                <div style="width:<%= (@infograph.effective_less_3.ceil)*30 %>px"></div>
                <span class="focus2"><%= @infograph.effective_less_3.ceil %></span> in <span class="focus3">10</span> <br>reviewers found this <br>drug ineffective.
              </div>

              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- Carousel nav -->
      <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
      <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
    </div>


  </div>

  <div id="static_buttons" class="span12">
    <h3>Control Panel</h3>
    <%= render "chart_buttons" %>
    <p class="notification"><span class="label label-info">Info</span> The buttons above controls the plot view. Click on them to see various statistics of this drug!</p>
  </div>


  <h3 id="review_title"><%= @drug.brand_name%> Reviews</h3>

  <div id="write_review" class="span3 offset4">
    <button  class="btn btn-primary" type="button">Write Review</button>
  </div>









  <%= form_for ([@drug,@review]),:remote=>true,:html => {:class => "form-horizontal hide span12"} do |f| %>



    <%= fields_for @user do |user_detail_form| %>
        <div class="control-group">
          <%= user_detail_form.label :username, "Username", :class=>"control-label" %>
          <div class="controls">
            <%= user_detail_form.text_field :username, :placeholder=>"John Doe"%> *
          </div>
        </div>
        <div class="control-group">
          <%= user_detail_form.label :email_address, "Email Address (to allow other reviewers to contact you)", :class=>"control-label" %>
          <div class="controls">
            <%= user_detail_form.text_field :email_address, :placeholder=>"John_Doe@abc.com"%>
          </div>
        </div>
        <div class="control-group">
          <%= user_detail_form.label :age, "Age Range", :class=>"control-label" %>
          <div class="controls">
          <%= user_detail_form.select :age, options_for_select([["3-6","3-6"],["7-12","7-12"],["13-18","13-18"],["19-24","19-24"],["25-34","25-34"],["35-44","35-44"],["45-54","45-54"],["55-64","55-64"],["65-74","65-74"],["75 or over","75 or over"]]),:prompt => "Select Age range" %>
          </div>
        </div>
        <div class="control-group">
          <%= user_detail_form.label :gender, "Gender", :class=>"control-label" %>
          <div class="controls">
            <%= user_detail_form.select :gender, options_for_select([["Male","Male"],["Female","Female"]]),:prompt => "Select Gender" %>
          </div>
        </div>
        <div class="control-group">
          <%= user_detail_form.label :ethnicity, "Ethnicity", :class=>"control-label" %>
          <div class="controls">
            <%= user_detail_form.select :ethnicity , options_for_select([["Mixed Race","Mixed Race"],
                                                                         ["Arctic (Siberian, Eskimo)","Arctic (Siberian, Eskimo)"],
                                                                         ["Caucasian (European)","Caucasian (European)"],
                                                                         ["Caucasian (Indian)","Caucasian (Indian)"],
                                                                         ["Caucasian (Middle East)","Caucasian (Middle East)"],
                                                                         ["Caucasian (North African, Other)","Caucasian (North African, Other)"],
                                                                         ["Indigenous Australian","Indigenous Australian"],
                                                                         ["Native American","Native American"],
                                                                         ["North East Asian (Mongol, Tibetan, Korean Japanese, etc)","North East Asian (Mongol, Tibetan, Korean Japanese, etc)"],
                                                                         ["Pacific (Polynesian, Micronesian, etc)","Pacific (Polynesian, Micronesian, etc)"],
                                                                         ["South East Asian (Chinese, Thai, Malay, Filipino, etc)","South East Asian (Chinese, Thai, Malay, Filipino, etc)"],
                                                                         ["West African, Bushmen, Ethiopian","est African, Bushmen, Ethiopian"],
                                                                         ["Other Race","Other Race"]]),:prompt => "Select Ethnicity"%>
          </div>
        </div>
        <div class="control-group">
          <%= user_detail_form.label :weight, "Weight", :class=>"control-label" %>
          <div class="controls">
            <%= user_detail_form.text_field :weight %>
          </div>
        </div>

    <% end %>
    <div class="control-group">
      <%= f.label :comments, "Write A Review For This Drug", :class=>"control-label" %>
      <div class="controls">
        <%= f.text_area :comments, :size=> "44x6", :class=>"input-xxlarge" %> *
      </div>
    </div>

    <div class="control-group">
      <%= f.label :effectiveness, "How Effective Is This Drug? (1: not effective , 5: very effective)", :class=>"control-label" %>
      <div class="controls">
        <%= f.radio_button :effectiveness, "1" %> 1 |
        <%= f.radio_button :effectiveness, "2" %> 2 |
        <%= f.radio_button :effectiveness, "3" %> 3 |
        <%= f.radio_button :effectiveness, "4" %> 4 |
        <%= f.radio_button :effectiveness, "5" %> 5   *
      </div>
    </div>
    <div class="control-group">
      <%= f.label :ease_of_use, "Is This Drug Easy To Use? (1: not easy to use , 5: very easy to use)", :class=>"control-label" %>
      <div class="controls">
        <%= f.radio_button :ease_of_use, "1" %> 1 |
        <%= f.radio_button :ease_of_use, "2" %> 2 |
        <%= f.radio_button :ease_of_use, "3" %> 3 |
        <%= f.radio_button :ease_of_use, "4" %> 4 |
        <%= f.radio_button :ease_of_use, "5" %> 5     *
      </div>
    </div>
    <div class="control-group">
      <%= f.label :satisfactory, "Are You Satisfied With This Drug? (1: not satisfied, 5: very satisfied)", :class=>"control-label" %>
      <div class="controls">
        <%= f.radio_button :satisfactory, "1" %> 1 |
        <%= f.radio_button :satisfactory, "2" %> 2 |
        <%= f.radio_button :satisfactory, "3" %> 3 |
        <%= f.radio_button :satisfactory, "4" %> 4 |
        <%= f.radio_button :satisfactory, "5" %> 5    *
      </div>
    </div>
    <div class="control-group">
      <%= f.label :usage_duration_days, "How long have you been using this drug?", :class=>"control-label" %>
      <div class="controls">
        <%= f.select :usage_duration_days, options_for_select([["< than a day",1],["<a week",7],["<a month",30],["<a year",365]]) %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :other_drugs, "List Any Other Drugs You Are Consuming?", :class=>"control-label" %>
      <div class="controls">
        <%= f.text_field :other_drugs%>
      </div>
    </div>
    <%= hidden_field_tag :drug_id, @drug.id%>
    <div id="error_explanation" class="hide"></div>
    <div class="control-group">
      <div class="controls">
        <%= f.submit "Submit Review" ,:class=>"btn btn-primary"%> (* :required fields)
      </div>
    </div>



<% end %>


<div id="reviews_section" class="span12">
  <%= render "reviews", :locals => { :list => true } %>
</div>

</div>


